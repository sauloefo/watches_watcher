# Staging environment deployment configuration
# Inherits from config/deploy.yml and overrides specific settings for staging

# Deploy to these staging servers
servers:
  web:
    - 46.62.209.116
  # job:
  #   hosts:
  #     - 192.168.0.1
  #   cmd: bin/jobs

# Enable SSL auto certification via Let's Encrypt for staging
# If used with Cloudflare, set encryption mode in SSL/TLS setting to "Full" to enable CF-to-app encryption.
#
# Using an SSL proxy like this requires turning on config.assume_ssl and config.force_ssl in staging.rb!
#
# Don't use this when deploying to multiple web servers (then you have to terminate SSL at your load balancer).
#
# proxy:
#   ssl: true
#   host: staging.example.com

# Build with staging environment
builder:
  args:
    RAILS_ENV: staging

# Inject ENV variables into containers for staging
env:
  clear:
    # Set Rails environment to staging
    RAILS_ENV: staging

    # Run the Solid Queue Supervisor inside the web server's Puma process to do jobs.
    # When you start using multiple servers, you should split out job processing to a dedicated machine.
    SOLID_QUEUE_IN_PUMA: true

    # Set number of processes dedicated to Solid Queue (default: 1)
    # JOB_CONCURRENCY: 3

    # Set number of cores available to the application on each server (default: 1).
    # WEB_CONCURRENCY: 2

    # In lab infrastructure, applications and databases run in separate containers.
    PRIMARY_DATABASE_HOST: postgresql_container

    # Log everything from Rails in staging for debugging
    # RAILS_LOG_LEVEL: debug

# Use a persistent storage volume for staging files and local Active Storage files.
# Separate from production volumes
volumes:
  - "wawa_staging_storage:/rails/storage"
